@{
    ViewData["Title"] = "Checkout";
}

<div class="container mt-5">
    <h2>Checkout -- Development in Prog</h2>

  <div class="credit-card">
        <div class="card-header">
            <div class="card-chip"></div>
            <div class="card-logo">💳</div>
        </div>

        <div class="card-number-container">
            <input type="text" id="cardNumber" class="form-control card-number" placeholder="1234 5678 9012 3456"
                maxlength="19" required oninput="updateCardDisplay()" />
        </div>

        <div class="card-details">
            <div class="cardholder">
                <label>Cardholder</label>
                <input type="text" id="cardholderName" class="form-control cardholder-name" placeholder="John Doe"
                    required oninput="updateCardDisplay()" />
            </div>
            <div class="expiry">
                <label>Expires</label>
                <input type="text" id="expiryDate" class="form-control expiry-date" placeholder="MM/YY" maxlength="5"
                    required oninput="updateCardDisplay()" />
            </div>
            <div class="cvv">
                <label>CVV</label>
                <input type="text" id="cvv" class="form-control cvv-code" placeholder="123" maxlength="3" required />
            </div>
        </div>
    </div>

    <!-- Total Amount -->
    <div class="total-amount text-center">
        <h4>Total Booking Amount: £<span id="totalAmount">99.99</span></h4>
    </div>

    <button type="button" class="btn btn-success w-100 mt-3" onclick="processPayment()">Pay Now</button>

</div>

<script>
    function processPayment() {
        let cardholderName = document.getElementById("cardholderName").value.trim();
        let cardNumber = document.getElementById("cardNumber").value.replace(/\s/g, ""); // Remove spaces
        let expiryDate = document.getElementById("expiryDate").value.trim();
        let cvv = document.getElementById("cvv").value.trim();
        let totalAmount = document.getElementById("totalAmount").innerText;

        // Simple validation
        if (!cardholderName || !cardNumber || !expiryDate || !cvv) {
            alert("Please fill in all card details.");
            return;
        }

        if (!/^\d{16}$/.test(cardNumber)) {
            alert("Invalid Card Number. It should be 16 digits.");
            return;
        }

        if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
            alert("Invalid Expiry Date. Use MM/YY format.");
            return;
        }

        if (!/^\d{3}$/.test(cvv)) {
            alert("Invalid CVV. It should be 3 digits.");
            return;
        }

        alert(`Payment Successful! £${totalAmount} charged.`);
        window.location.href = "/orderconfirmation"; // Redirect after payment
    }

    // Auto-format card number input
    document.getElementById("cardNumber").addEventListener("input", function () {
        this.value = this.value.replace(/\D/g, "").replace(/(.{4})/g, "$1 ").trim();
    });
</script>
