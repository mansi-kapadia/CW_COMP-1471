@model IEnumerable<CW_COMP_1471.Models.Play>

@{
    ViewData["Title"] = "Available Plays";
}

<h2 class="text-center mb-4">Available Plays</h2>

<div class="container">
    <div class="row">
        @foreach (var play in Model)
        {
            <div class="col-md-4 mb-4">
                <div class="card shadow-lg h-100">
                    <img src="@play.ImageUrl" class="card-img-top img-fixed" alt="@play.Title">
                    <div class="card-body">
                        <h5 class="card-title">@play.Title</h5>
                        <h6 class="card-subtitle text-muted">@play.Genre</h6>
                        <p class="card-text mt-2">@play.Description</p>
                        <p><strong>Date & Time:</strong> @play.Dateandtime.ToString("dd-MM-yyyy hh:mm tt")</p>
                        <p><strong>Play Type:</strong> @play.PlayType</p>
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="input-group" style="width: 120px;">
                                <button class="btn btn-outline-secondary" type="button" onclick="decrement(@play.PlayId)">-</button>
                                <input type="text" id="ticketCount-@play.PlayId" class="form-control text-center" value="1" readonly />
                                <button class="btn btn-outline-success" type="button" onclick="increment(@play.PlayId)">+</button>
                            </div>
                            <button class="btn btn-success" onclick="addToBooking(@play.PlayId)">Add to Cart</button>
                        </div>
                    </div>
                </div>
            </div>

        }
    </div>
</div>

<script>
    function increment(PlayId) {
        var input = document.getElementById("ticketCount-" + PlayId);
        var value = parseInt(input.value);
        if (value < 10) { // Limit max tickets to 10
            input.value = value + 1;
        }
    }

    function decrement(PlayId) {
        var input = document.getElementById("ticketCount-" + PlayId);
        var value = parseInt(input.value);
        if (value > 1) { // Prevent going below 1
            input.value = value - 1;
        }
    }

   function addToBooking(PlayId) {
    var count = document.getElementById("ticketCount-" + PlayId)?.value;

    if (!count) {
        console.error("Missing input values");
        return;
    }

    var booking = {
        UserId : 0,
        Quantity: parseInt(count),
        PlayId: PlayId,
    };

    fetch('/api/bookings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(booking)
    })
    .then(response => response.json())
    .then(data => {        
        alert(data.message);
        let cartCountElement = document.getElementById("cartCount");
        cartCountElement.textContent = data.result;
    })
    .catch(error => console.error('Error:",', error));
}



</script>
